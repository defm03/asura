### Known issues (from arch wiki)
## Troubleshooting boot problems
# If you are using an Intel video chipset and the screen goes blank 
# during the boot process, the problem is likely an issue with Kernel
# Mode Setting. A possible workaround may be achieved by rebooting 
# and pressing e over the entry that you are trying to boot (i686 or 
# x86_64). At the end of the string type nomodeset and press Enter. 
# Alternatively, try 'video=SVIDEO-1:d' which, if it works, will not 
# disable kernel mode setting. You can also try 'i915.modeset=0'.
## 

# config: globals and defaults
errnum=
random="date +%N | sed -e 's/000$//' -e 's/^0//'"
PACKAGES=""
arch=""
key_layout="us"
def_font="Lat2-Terminus16"
localegen="/locale-gen.patch"
lang=en_US.UTF-8

error_sig ()
{
	echo "asura error:$errnum"
	echo -n "Description: "
	case $errnum in
		1) echo "";;
		2) echo "";;
		3) echo "";;
	esac
	echo "Check 'troubleshooting' in 'doc' directory"
	echo "Check github issues: https://github.com/defm03/asura/issues"

}

make_logfile ()
{
	echo -n "ASURA BUILD ERROR LOG" >> builderror.log
	date >> builderror.log
	echo "=========================================" >> builderror.log
}

make_logfile

## Here will go: 
# 1. Choosing architecture
# 2. Choosing key layout.
# 3. Choosing locale.gen patch
# For now it's not here, because I'm testing with only one set of 
# settings at the moment.

## Loading key layout 
#
echo "Setting your key layout to '$key_layout' (...)"
loadkeys $key_layout
if [ $? -eq 0 ]
then
	echo "[+] Your key layout ('$key_layout') is successfully set."
else
	$errnum=1
	echo "[!] error$errnum: command: 'loadkeys'" >> builderror.log
	error_sig
fi

## Setting font 
#
echo "Setting your font to '$def_font' (...)"
setfont $def_font
if [ $? -eq 0 ]
then
	echo "[+] Your font ('$def_font') is successfully set."
else
	$errnum=1
	echo "[!] error$errnum: command: 'setfont'" >> builderror.log
	error_sig
fi

## Edditing and running locale-gen - setting up language 
#
echo "Editting your locale.gen file with '$localegen'(...)"
patch -p1 < /locale-gen.patch
if [ $? -eq 0 ]
then
	echo "[+] Your locale.gen file is successfully edited."
else
	$errnum=1
	echo "[!] error$errnum: command: 'patch -p1'" >> builderror.log
	error_sig
fi

echo "Running locale-gen command (...)"
locale-gen
if [ $? -eq 0 ]
then
	echo "[+] Locale-gen is successful."
else
	$errnum=1
	echo "[!] error$errnum: command: 'locale-gen'" >> builderror.log
	error_sig
fi

echo "Exporting LANG ('$lang') (...)"
export LANG=$lang
if [ $? -eq 0 ]
then
	echo "[+] LANG is exported successfully."
else
	$errnum=1
	echo "[!] error$errnum: command: 'export LANG=$lang'" >> builderror.log
	error_sig
fi
